using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;

namespace APlusMalware.LogicLaserPlugin
{
    public class PlayerSource : IPlayerSource
    {
        public ReadOnlyCollection<Player> Players { get; private set; }

        public void Update()
        {
            List<Player> players = new List<Player>();
            if (WorldScript.mbHasPlayer)
                players.Add(WorldScript.mLocalPlayer);
            
            if (NetworkManager.mbHostingServer)
                players.AddRange(NetworkManager.instance.mServerThread.GetConnections().Select(c => c.mPlayer));
            else if (NetworkManager.mbClientRunning && !WorldScript.mbIsServer)
                players.AddRange(NetworkManager.instance.mClientThread.mOtherPlayers.Values);

            Players = players.AsReadOnly();
        }
    }
}
