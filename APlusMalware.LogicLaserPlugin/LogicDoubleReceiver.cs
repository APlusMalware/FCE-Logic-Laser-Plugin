using System;

namespace APlusMalware.LogicLaserPlugin
{
    public abstract class LogicDoubleReceiver : LogicReceiver
    {
        private Byte _bottomDirection;
        private Byte _topDirection;

        protected LogicDoubleReceiver(Segment segment, Int64 x, Int64 y, Int64 z, UInt16 cubeType, Byte flags, UInt16 value)
            : base(segment, x, y, z, cubeType, flags, value, new TwoInputReceiveOnlyNode())
        {
            UpdateFaces(flags);
        }

        public override SByte FindFaceInputIndex(Byte direction)
        {
            if (direction == _bottomDirection)
                return -1;
            // The second input is the top
            if (direction == _topDirection)
                return 1;
            // The first input is any side (left, right, front, back)
            return 0;
        }

        private void UpdateFaces(Byte flags)
        {
            _topDirection = Utils.CalcTopDirection(flags);
            _bottomDirection = Utils.CalcOppositeDirection(_topDirection);
        }
    }
}
