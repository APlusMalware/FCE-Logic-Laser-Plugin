using System;

namespace APlusMalware.LogicLaserPlugin
{
    public class LogicPowerSensor : LogicSensor
    {
        public LogicPowerSensor(Segment segment, Int64 x, Int64 y, Int64 z, UInt16 cubeType, Byte flags, UInt16 value)
            : base(segment, x, y, z, cubeType, flags, value)
        {
        }

        protected override Byte CalculateOutput(SegmentEntity entity, UInt16 data)
        {
            PowerConsumerInterface powerConsumerInterface = entity as PowerConsumerInterface;
            if (powerConsumerInterface == null)
                return 0;
            Double remainingPower = Math.Round(powerConsumerInterface.GetRemainingPowerCapacity(), MidpointRounding.AwayFromZero);
            Double maxPower = Math.Round(powerConsumerInterface.GetMaxPower(), MidpointRounding.AwayFromZero);
            return (Byte)((1f - remainingPower / maxPower) * 255f);
        }
    }
}
