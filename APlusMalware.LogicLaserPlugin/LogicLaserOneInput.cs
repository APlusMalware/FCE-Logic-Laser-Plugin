using System;
using APlusMalware.LogicGraph;

namespace APlusMalware.LogicLaserPlugin
{
    public abstract class LogicLaserOneInput : LaserLogicBase
    {
        private Byte _backFace;
        private Byte _leftFace;
        private Byte _rightFace;
        private Byte _topFace;
        private Byte _bottomFace;

        protected LogicLaserOneInput(eSegmentEntity segmentEntity, SpawnableObjectEnum spawnableObject, Int64 x, Int64 y,
            Int64 z, UInt16 cube, Byte flags, UInt16 value, Segment segment, LogicNode<Byte> node)
            : base(segmentEntity, spawnableObject, x, y, z, cube, flags, value, segment, node)
        {
            UpdateFaces(flags);
        }

        public override SByte FindFaceInputIndex(Byte face)
        {
            if (face == _backFace)
                return 0;
            if (face == _leftFace)
                return 1;
            if (face == _rightFace)
                return 2;
            if (face == _topFace)
                return 3;
            if (face == _bottomFace)
                return 4;
            return -1;
        }

        public override void OnUpdateRotation(byte flags)
        {
            base.OnUpdateRotation(flags);
            UpdateFaces(flags);
        }

        private void UpdateFaces(Byte flag)
        {
            _backFace = Utils.CalcBackFace(flag);
            _leftFace = Utils.CalcLeftFace(flag);
            _rightFace = Utils.CalcOppositeFace(_leftFace);
            _topFace = Utils.CalcTopFace(flag);
            _bottomFace = Utils.CalcOppositeFace(_topFace);
        }
    }
}
